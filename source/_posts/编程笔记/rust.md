---
title: rust笔记
categories: rust
tags: rust
author: Noodles
comments: true
index_img: /img/px.png
excerpt: 安全、效率是软件的发展方向
date: 2022-11-22 10:00:00
updated: 2022-09-28 20:00:00
---

## 为什么要学习rust

rust越来越火了，但是目前正在使用rust的项目并不多，工作岗位基本没有。那么有必要学习rust吗？我的看法是不必要，但是值得了解和学习。站在我的角度有以下几点理由：

1、RUST解决问题的思路，符合当前发展的方向。计算机技术发展了这么多年，期间编程语言也在不断发展，但是一直以来有几个问题在来回拉扯：性能，安全和表达能力。先说安全问题，以我从业的嵌入式行业来看，遇到严重的问题大部分都是因为内存管理引入的问题。主要原因是因为嵌入式式环境使用的C和C++。我们知道这是历史悠久而又生命力顽强的语言，这主要得益与它们性能高，但是他们不支持垃圾回收就导致了很容易出现内存不安全问题。虽然C++引入了智能指针，还有RAII等特性极大的防止内存问题。但是它依旧保留了极大的自由度给程序员，只要把不安全的方式留着，就会引入问题,毕竟写程序最大的不可控因素是人。从我身边的例子看，引入问题不仅仅是那些新手程序员，即使那些极优秀且有多年经验的程序员一样会引入内存问题。而且越是厉害的程序员，引入的问题往往不容易被发现，等到发现的时候那就是重大事故。除了C和C++外我们看看那些安全的语言右有什么问题，那使用最广发的JAVA和python来说，他们依靠垃圾回收很好的解决了内存安全问题，而且无论是表达力，或者开发效率都及其优秀。但是因为引入垃圾回收，性能就比较拉跨。而且他们的运行需要虚拟机，所以在嵌入式开发中就受限了。而rust结合了众多语言的特点，兼具性能和安全。当然为了同时满足性能和安全，它牺牲了一定的易用性。这里的易用性不是说它的表达力不够，或者说很难写。我认为主要是初期的上手门槛会比较高。对于一个项目来说，它把问题暴漏在了前端，但你的项目只要编译通过。就很少担心内存方面的问题了。我认为这种解决问题的思路是值得学习的。

2、对于嵌入式开发来说，需要一门表达力强的语言。现在嵌入式设备到处都是，我们能看到的设备，比如家里的灯具，音箱，随处可见的摄像头等等，都跑了负责的软件。C语言是及其优秀的语言，这么多年了，依旧是热门的语言。它简单，自由，甚至说整个数字世界的底座就是C语言编写的。但是对于现在软件开发来说，它过于质朴，很多新的编程概念它都不支持。C++语言在嵌入式中也发挥巨大作用，但是就我个人而言不太喜欢C++的哲学。这么多年来，C++不断发展，不断引入新的概念，使它成为及其强大的语言。包含了各种特性，但是也是因为它太丰富，所以很难掌握C++的所有特性，即使你掌握了很多，但是它给给你的选择太多了。你去找两个C++的项目，往往感觉像是用不同语言编写的。这种啥都想要的思想我是不太喜欢。

3、完善的工具链，我在写这篇博客的时候已经简单浏览了一个完整的RUST教程，并编写了几个简单的程序。给我一个最大的体会是，RUST的工具链简直太好用了。我们不需要下载GCC,不需要学习cmake,只需要一键安装语言包，就可以直接开始开发了，而且它的官网就有优秀的教程，在线编译器同时它还具有cargo包管理工具，甚至可以一键写文档。这才是一门现代语言应该有的样子。我们已经有这么大的软件基石，当每次还需要手动管理项目和代码的确实不是一个很好的方式。

4 

## 下面是学习rust的一些资料

一个优秀的RUST教程：[Rust语言圣经](https://course.rs/about-book.html)

## rust笔记

完整了解了一边RUST之后我决定认真的学习rust，同时呢我希望把自己学习的过程记录下来，所以后面会有一系列RUST的学习笔记。

rust常用命令：

```shell
版本更新：
$ rustup update

卸载：
$ rustup self uninstall

查询版本
$ rustc -V

打开本地文档
$ rustup doc

编译release版本（运行速度快于debug版本，但编译会变慢）
$ cargo run --release
$ cargo build --release

快速的检查一下代码能否编译通过
cargo check
```

Vscode好用的rust插件：

rust-analyzer

其他推荐的插件

1. `Even Better TOML`，支持 .toml 文件完整特性
2. `Error Lens`, 更好的获得错误展示
3. `One Dark Pro`, 非常好看的 VSCode 主题
4. `CodeLLDB`, Debugger 程序

rust的安装非常简单，按照教程中操作很快可以安装完成，安装完成后我们在终端执行：cargo new world_hello 就可以生成一个项目。

```shell
项目目录如下
world_hello
.
├── .git
├── .gitignore
├── Cargo.toml
└── src
    └── main.rs
```

hello,word!

```rust
fn greet_world() {
    let southern_germany = "Grüß Gott!";
    let chinese = "世界，你好";
    let english = "World, hello";
    let regions = [southern_germany, chinese, english];
    for region in regions.iter() {
        println!("{}", &region);
    }
}

fn main() {
    greet_world();
}
```

学习第一门语言一般都是以helloword开始。我们看看上面的代码直观看它有了很多高级语言的写法。让我一个以C为主要语言的人来RUST简直太优雅了。

tips：[解决下载依赖慢的方法](https://course.rs/first-try/slowly-downloading.html)

计算机发展几十年，编程语言也在一直发展，但是往往一门语言出现解决了一个方面的问题就有牺牲了另一个方面。比如C语言高效，但是内存问题一直困扰着C程序员，也让C语言一直饱受诟病。python的简单，安全，但是运行速度慢。一门既要又要的语言实属难得。rust设计的目的要做到既要内存安全又要高效。

rust1.0版本于2015年发布到现在发布到1.77.1版本而且还在持续更新。rust的更新速度非常快，而且rust的更新速度是其他语言无法比拟的。在《RUST编程之道》中将rust中的概念抽象为4个层次。

1、混合编程范式，包含面向对象和函数式编程
2、语义：所有权，MOVE、COPY、借用、生命周期、DROP
3、类型系统：泛型、trait、一切皆类型、多态、类型推断
4、安全内存管理：栈、RAII、堆

对于开发者来说在实际使用时只需要关注前三层，内存安全编译器会自动帮我们处理。以往学习一门语言最好的办法时直接上编码，在编码和阅读中熟悉概念，但是rust可以先理解清楚对应的语法在动手。



此处我们简单看一下,代码是如何变成最终的机器码的?我们在一个编辑器写代码,写的就是人可以理解的字符,但是机器是不懂的,机器最终只会执行一堆二进制码,也就是机器码.在我们使用对于的编程语言写完代码后,如果要在硬件上执行,就需要做一定的转换,将代码转化为机器可以识别的二进制码.这就是编译器.编译器需要根据语法规则,将人编写的代码转化为机器码,一般情况下分为,三个大的步骤,编译,链接,优化.

Rust是跨平台语言，一次编译，到处运行，这得益于LLVM。Rust编译器是一个LLVM编译前端，它将代码编译为LLVM IR，然后经过LLVM编译为相应的平台目标。Rust 源码经过分词和解析，生成 AST（抽象语法树）。然后把 AST 进一步简化处理为HIR（High-level IR），目的是让编译器更方便地做类型检查。HIR 会进一步被编译为 MIR （Middle IR），这是一种中间表示，它在Rust1.12版本中被引入，主要用于以下目的。· 缩短编译时间。MIR可以帮助实现增量编译，当你修改完代码重新编译的时候，编译器只计算更改过的部分，从而缩短了编译时间。· 缩短执行时间。MIR 可以在 LLVM 编译之前实现更细粒度的优化，因为单纯依赖LLVM的优化粒度太粗，而且Rust无法控制，引入MIR就增加了更多的优化空间。· 更精确的类型检查。MIR 将帮助实现更灵活的借用检查，从而可以提升 Rust 的使用体验。最终，MIR会被翻译为LLVM IR，然后被LLVM的处理编译为能在各个平台上运行的目标机器码。

现在的编程语言层出不群,从工程角度看,是因为没有一种编程语言可以满足所有的应用场景.比如C语言,灵活强大,但是对于应用层的开发,不能满足快速的应用开发,同时内存安全不能得到保障.

rust似乎是想要做到既要又要,
